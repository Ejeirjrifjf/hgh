<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù†Ù‚Ø· - Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --main-bg: #f8fafc;
            --card-bg: #ffffff;
            --primary: #4f46e5;
            --accent: #10b981;
            --text-dark: #1e293b;
            --text-light: #64748b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Tajawal', sans-serif; background: var(--main-bg); color: var(--text-dark); line-height: 1.6; }

        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        #app-interface { padding-bottom: 110px; }

        .top-bar {
            background: white; padding: 15px; display: flex; flex-direction: column;
            gap: 15px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .bar-header { display: flex; justify-content: space-between; align-items: center; width: 100%; }

        .section-selector { display: flex; background: #f1f5f9; padding: 4px; border-radius: 12px; width: 100%; }
        .sec-btn {
            flex: 1; padding: 10px; border: none; border-radius: 10px; cursor: pointer;
            font-weight: 700; color: var(--text-light); background: transparent; transition: 0.3s;
        }
        .sec-btn.active { background: white; color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }

        .content-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px; padding: 15px;
        }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø§Ø¯Ø© */
        .subject-card {
            background: var(--card-bg); border-radius: 20px; padding: 18px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;
        }

        .sub-header { display: flex; justify-content: space-between; margin-bottom: 15px; align-items: center; }
        .sub-name { font-weight: 900; font-size: 1.1rem; display: flex; align-items: center; gap: 8px; }
        .sub-avg-label { color: var(--accent); font-weight: 900; font-size: 1.1rem; background: #ecfdf5; padding: 2px 10px; border-radius: 8px; }

        .inputs-group { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .input-box { display: flex; flex-direction: column; gap: 4px; }
        .input-box label { font-size: 0.7rem; color: var(--text-light); font-weight: 700; white-space: nowrap; }
        
        input {
            width: 100%; padding: 12px 5px; border: 1px solid #e2e8f0; border-radius: 10px;
            text-align: center; font-weight: 700; font-size: 1rem; color: var(--text-dark);
            background: #f8fafc; -webkit-appearance: none;
        }
        input:focus { border-color: var(--primary); outline: none; background: #fff; ring: 2px solid var(--primary); }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø³ÙÙ„ÙŠ */
        .bottom-results {
            position: fixed; bottom: 0; left: 0; right: 0; background: white;
            padding: 12px 10px; border-top: 1px solid #e2e8f0; display: flex;
            justify-content: space-between; align-items: center; z-index: 1000;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.05);
        }
        .res-item { text-align: center; flex: 1; }
        .res-item span { display: block; font-size: 0.65rem; color: var(--text-light); font-weight: 700; }
        .res-item b { font-size: 1.1rem; color: var(--primary); }
        .res-item.total b { color: #ffffff; background: var(--primary); padding: 4px 12px; border-radius: 10px; font-size: 1.2rem; }

        .btn-reset { color: #ef4444; background: none; border: 1px solid #fee2e2; padding: 5px 12px; border-radius: 8px; font-size: 0.8rem; font-weight: bold; cursor: pointer; }

        @media (max-width: 400px) {
            .inputs-group { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body onload="initApp()">

    <div id="app-interface">
        <div class="top-bar">
            <div class="bar-header">
                <h2 style="font-size: 1.2rem;">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</h2>
                <button class="btn-reset" onclick="clearData()">Ù…Ø³Ø­ Ø§Ù„Ù†Ù‚Ø·</button>
            </div>
            <div class="section-selector">
                <button class="sec-btn active" id="btn-m" onclick="switchSection('monitoring')">Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø©</button>
                <button class="sec-btn" id="btn-e" onclick="switchSection('exam')">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù…ÙˆØ­Ø¯</button>
            </div>
        </div>

        <div id="monitoring-area" class="content-grid"></div>
        <div id="exam-area" class="content-grid" style="display:none"></div>

        <div class="bottom-results">
            <div class="res-item"><span>Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</span><b id="res-m">0.00</b></div>
            <div class="res-item"><span>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</span><b id="res-e">0.00</b></div>
            <div class="res-item total"><span>Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…</span><b id="res-total">0.00</b></div>
        </div>
    </div>

<script>
    const subjects = [
        { name: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", icon: "ğŸ“–", coef: 3 },
        { name: "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª", icon: "ğŸ“", coef: 3 },
        { name: "Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©", icon: "ğŸ‡«ğŸ‡·", coef: 3 },
        { name: "Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª", icon: "ğŸŒ", coef: 1 },
        { name: "Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡", icon: "ğŸ§ª", coef: 1 },
        { name: "SVT", icon: "ğŸŒ±", coef: 1 },
        { name: "Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", icon: "ğŸŒ™", coef: 1 },
        { name: "Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", icon: "ğŸ‡¬ğŸ‡§", coef: 1 },
        { name: "Ø§Ù„Ø¨Ø¯Ù†ÙŠØ©", icon: "ğŸƒ", coef: 1 },
        { name: "Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§", icon: "âš™ï¸", coef: 1 },
        { name: "Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…ÙŠØ§Øª", icon: "ğŸ’»", coef: 1 }
    ];

    let db = { m: {}, e: {} };

    function initApp() {
        const saved = localStorage.getItem('gradeDB_S2_Final');
        db = saved ? JSON.parse(saved) : { m: {}, e: {} };
        renderCards();
    }

    function renderCards() {
        const mArea = document.getElementById('monitoring-area');
        const eArea = document.getElementById('exam-area');
        mArea.innerHTML = ""; eArea.innerHTML = "";

        subjects.forEach((s, i) => {
            // Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
            let mCard = document.createElement('div');
            mCard.className = 'subject-card';
            mCard.innerHTML = `
                <div class="sub-header">
                    <span class="sub-name">${s.icon} ${s.name}</span>
                    <span class="sub-avg-label" id="avg-${i}">0.00</span>
                </div>
                <div class="inputs-group">
                    <div class="input-box"><label>ÙØ±Ø¶ 1</label><input type="number" inputmode="decimal" oninput="v(this); sM(${i},0,this.value)" value="${db.m[i]?.[0] || ''}"></div>
                    <div class="input-box"><label>ÙØ±Ø¶ 2</label><input type="number" inputmode="decimal" oninput="v(this); sM(${i},1,this.value)" value="${db.m[i]?.[1] || ''}"></div>
                    <div class="input-box"><label>ÙØ±Ø¶ 3</label><input type="number" inputmode="decimal" oninput="v(this); sM(${i},2,this.value)" value="${db.m[i]?.[2] || ''}"></div>
                    <div class="input-box"><label>ÙØ±Ø¶ 4</label><input type="number" inputmode="decimal" oninput="v(this); sM(${i},3,this.value)" value="${db.m[i]?.[3] || ''}"></div>
                    <div class="input-box" style="grid-column: span 2"><label>Ø§Ù„Ø£Ù†Ø´Ø·Ø©</label><input type="number" inputmode="decimal" oninput="v(this); sM(${i},4,this.value)" value="${db.m[i]?.[4] || ''}"></div>
                </div>`;
            mArea.appendChild(mCard);

            // Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            let eCard = document.createElement('div');
            eCard.className = 'subject-card';
            eCard.innerHTML = `
                <div class="sub-header"><span class="sub-name">${s.icon} ${s.name}</span></div>
                <div class="input-box">
                    <label>Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù…ÙˆØ­Ø¯</label>
                    <input type="number" inputmode="decimal" oninput="v(this); sE(${i},this.value)" value="${db.e[i] || ''}">
                </div>`;
            eArea.appendChild(eCard);
        });
        calc();
    }

    function v(el) {
        if (parseFloat(el.value) > 20) el.value = "20";
    }

    function sM(r, c, val) { if(!db.m[r]) db.m[r] = {}; db.m[r][c] = val; sync(); }
    function sE(r, val) { db.e[r] = val; sync(); }
    function sync() { localStorage.setItem('gradeDB_S2_Final', JSON.stringify(db)); calc(); }

    function calc() {
        let mTotal = 0, eTotal = 0, totalCoef = 0;
        subjects.forEach((s, i) => {
            const d = db.m[i] || {};
            let vals = [0,1,2,3,4].filter(k => d[k] && d[k]!=="").map(k => parseFloat(d[k]));
            let subAvg = vals.length > 0 ? (vals.reduce((a,b)=>a+b,0)/vals.length) : 0;
            
            document.getElementById(`avg-${i}`).innerText = subAvg.toFixed(2);
            mTotal += (subAvg * s.coef);
            eTotal += ((parseFloat(db.e[i]) || 0) * s.coef);
            totalCoef += s.coef;
        });

        const finalM = mTotal / totalCoef;
        const finalE = eTotal / totalCoef;
        document.getElementById('res-m').innerText = finalM.toFixed(2);
        document.getElementById('res-e').innerText = finalE.toFixed(2);
        document.getElementById('res-total').innerText = ((finalM + finalE) / 2).toFixed(2);
    }

    function switchSection(sec) {
        document.getElementById('monitoring-area').style.display = sec === 'monitoring' ? 'grid' : 'none';
        document.getElementById('exam-area').style.display = sec === 'exam' ? 'grid' : 'none';
        document.getElementById('btn-m').classList.toggle('active', sec === 'monitoring');
        document.getElementById('btn-e').classList.toggle('active', sec === 'exam');
        window.scrollTo(0,0);
    }

    function clearData() {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø·ØŸ")) {
            db = { m: {}, e: {} };
            sync();
            renderCards();
        }
    }
</script>
</body>
</html>
